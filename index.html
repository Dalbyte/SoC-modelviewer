<html>
<head>
  <title>XR Test</title>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <link rel="stylesheet" href="./style.css" type="text/css" />
</head>
<body>

    
    <model-viewer
      src=""
      ios-src=""
      poster=""
      shadow-intensity="1"
      ar
      autoplay
      auto-rotate
      camera-target="0m 0.1m 0.05m"
      camera-controls
      quick-look-browsers="safari chrome"
      ar-modes="webxr scene-viewer quick-look"
      alt="A 3D model carousel"
      id="model-viewer"
    >  
        <button slot="ar-button" id="ar-button">
          View in your space
        </button>
      
        <div id="ar-prompt">
          <img src="https://songsofcultures.com/web-ar/hand.png">
        </div>
      
        <button id="ar-failure">
          AR is not tracking!
        </button>

        <button class="button1"  id="MusicOn" onclick="PlayStop(this)">
          â™« Music on!
        </button>
        
      
        <div class="slider">
          <div class="slides" id="ARelements">
            <!--Spawn Point Elements-->
          </div>
        </div>


      </model-viewer>

      <audio autoplay loop id="sound">
        <source src="https://songsofcultures.com/web-ar/audio/Goldkopf.mp3" type="audio/mpeg">
        <source src="https://songsofcultures.com/web-ar/audio/Goldkopf.ogg" type="audio/ogg">
        <p>Your browser doesn't support HTML5 audio.</p>
      </audio>

      <script>
        // Spawn Elements
        const divSlides = document.getElementById('ARelements');
        const ARelement = [
        "Buffalo",
        "Dachs",
        "Elefant",
        "Esel",
        "Fuchs",
        "FuchsGitarre",
        "FuchsPiano",
        "FuchsSchneemann",
        "Goldkopf",
        "GoldkopfMondlaute",
        "Hirsch",
        "Kuh",
        "KuhPiano",
        "Luchs",
        "LuchsChristmas",
        "LuchsTanz",
        "PonyBanjo",
        "Schaf",
        "SchafTrommel",
        "Schildkroete"
      ]
      let first = true;
      const baseEle = 'https://songsofcultures.com/web-ar/'; // Webpreview
      
      for (var i = 0; i < ARelement.length; i++){
        var newDiv = document.createElement("button");

        // First Element is selected
        if(first){
          newDiv.className = 'slide selected';
          first = false;
          // Audio Source Setup
          //AudioSwitch(ARelement[i]);


          // Modelviewer Setup
          let view = document.querySelector("model-viewer");
          view.src = './'+ARelement[i]+'.glb';
          view.setAttribute('ios-src','./'+ARelement[i]+'.usdz');
          view.setAttribute('poster',baseEle+ARelement[i]+'.webp');
        }else{
          newDiv.className = 'slide';
        }
        let path = baseEle + ARelement[i] + '.webp';
        newDiv.style.backgroundImage = 'url("' +path+'")';
        newDiv.setAttribute('onclick','switchSrc(this, "'+ARelement[i]+'")');
        divSlides.appendChild(newDiv);
      }

      // Audio Controll Interface
      function PlayStop(ButtonPress){
          var sound = document.querySelector("#sound");
          
          if(ButtonPress.id == "MusicOn"){
            sound.load();
            sound.play();
            ButtonPress.innerText = "ðŸ”‡ Music off!";
            ButtonPress.id = "MusicOff";
            // console.log("An");
          }else{
            sound.pause();
            sound.currentTime = 0;
            ButtonPress.innerText = "â™« Music on!";
            ButtonPress.id = "MusicOn";
            //console.log("Aus");
          }

      }

      // Switch Audio Source 
      function AudioSwitch(name){
          let sound = document.getElementById('sound');
          let AudioType = sound.children;

          for (let i = 0; i < AudioType.length; i++) {
            let element = AudioType[i];
            let baseaudio = 'https://songsofcultures.com/web-ar/audio/';
            if(element.getAttribute("type") == 'audio/mpeg'){
              element.src = baseaudio + name + '.mp3';
            }if(element.getAttribute("type") == 'audio/ogg') {
              element.src = baseaudio + name + '.ogg';
            }
          }
      }

      </script>


      
      <script type="module">
        const modelViewer = document.querySelector("model-viewer");
      
        window.switchSrc = (element, name) => {
          const base = './' + name;
          modelViewer.src = base + '.glb'; // Web
          modelViewer.setAttribute('ios-src',base+'.usdz') // IOS
          modelViewer.poster = base + '.webp';
          const slides = document.querySelectorAll(".slide");
          slides.forEach((element) => {element.classList.remove("selected");});
          element.classList.add("selected");

          // Audio Switch

          AudioSwitch(name);
          
          // console.log(sound.paused);

          if(!sound.paused){
            sound.load();
            sound.play();
            
          }
        };
      
        document.querySelector(".slider").addEventListener('beforexrselect', (ev) => {
          // Keep slider interactions from affecting the XR scene.
          ev.preventDefault();
        });
      </script>
</body>
</html>





